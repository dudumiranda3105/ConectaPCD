generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TipoDeficiencia {
  id        Int                  @id @default(autoincrement())
  nome      String               @unique
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  descricao String?
  subtipos  SubtipoDeficiencia[]
}

model SubtipoDeficiencia {
  id               Int                @id @default(autoincrement())
  nome             String
  tipoId           Int
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  CandidatoSubtipo CandidatoSubtipo[]
  barreiras        SubtipoBarreira[]
  tipo             TipoDeficiencia    @relation(fields: [tipoId], references: [id], onDelete: Cascade)
  VagaSubtipo      VagaSubtipo[]

  @@unique([tipoId, nome])
}

model Barreira {
  id                       Int                        @id @default(autoincrement())
  descricao                String                     @unique
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  acessibilidades          BarreiraAcessibilidade[]
  CandidatoSubtipoBarreira CandidatoSubtipoBarreira[]
  mitigacoesRecursos       RecursoBarreiraMitigacao[]
  subtipos                 SubtipoBarreira[]
}

model Acessibilidade {
  id                      Int                       @id @default(autoincrement())
  descricao               String                    @unique
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  barreiras               BarreiraAcessibilidade[]
  CandidatoAcessibilidade CandidatoAcessibilidade[]
  CandidatoSubtipo        CandidatoSubtipo[]
  VagaAcessibilidade      VagaAcessibilidade[]
}

model SubtipoBarreira {
  subtipoId  Int
  barreiraId Int
  barreira   Barreira           @relation(fields: [barreiraId], references: [id], onDelete: Cascade)
  subtipo    SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)

  @@id([subtipoId, barreiraId])
  @@index([barreiraId])
}

model BarreiraAcessibilidade {
  barreiraId       Int
  acessibilidadeId Int
  acessibilidade   Acessibilidade @relation(fields: [acessibilidadeId], references: [id], onDelete: Cascade)
  barreira         Barreira       @relation(fields: [barreiraId], references: [id], onDelete: Cascade)

  @@id([barreiraId, acessibilidadeId])
  @@index([acessibilidadeId])
}

model Empresa {
  id                           Int      @id @default(autoincrement())
  nome                         String
  cnpj                         String?  @unique
  email                        String?  @unique
  isActive                     Boolean  @default(true)
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt
  companyData                  Json?
  descricao                    String?
  endereco                     String?
  nomeFantasia                 String?
  password                     String?
  porte                        String?
  razaoSocial                  String?
  setor                        String?
  site                         String?
  telefone                     String?
  acessibilidadesOferecidas    String?
  bairro                       String?
  barreiras                    String?
  cep                          String?
  cidade                       String?
  complemento                  String?
  estado                       String?
  logradouro                   String?
  numero                       String?
  outrasBarreiras              String?
  outrosRecursosAcessibilidade String?
  politicasInclusao            String?
  possuiSistemaInterno         Boolean? @default(false)
  responsavelCargo             String?
  responsavelEmail             String?
  responsavelNome              String?
  responsavelTelefone          String?
  vagas                        Vaga[]

  @@index([email])
}

model Vaga {
  id              Int                  @id @default(autoincrement())
  empresaId       Int
  descricao       String
  escolaridade    String
  isActive        Boolean              @default(true)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  titulo          String               @default("Sem título")
  beneficios      String?
  regimeTrabalho  String?
  tipo            String?
  views           Int                  @default(0)
  candidaturas    Candidatura[]
  matchScores     MatchScore[]
  empresa         Empresa              @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  acessibilidades VagaAcessibilidade[]
  subtiposAceitos VagaSubtipo[]
}

model VagaSubtipo {
  vagaId    Int
  subtipoId Int
  subtipo   SubtipoDeficiencia @relation(fields: [subtipoId], references: [id], onDelete: Cascade)
  vaga      Vaga               @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@id([vagaId, subtipoId])
  @@index([subtipoId])
}

model VagaAcessibilidade {
  vagaId           Int
  acessibilidadeId Int
  createdAt        DateTime       @default(now())
  disponivel       Boolean        @default(true)
  observacoes      String?
  qualidade        String         @default("boa")
  updatedAt        DateTime       @updatedAt
  acessibilidade   Acessibilidade @relation(fields: [acessibilidadeId], references: [id], onDelete: Cascade)
  vaga             Vaga           @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@id([vagaId, acessibilidadeId])
  @@index([acessibilidadeId])
}

model Candidato {
  id                 Int                         @id @default(autoincrement())
  nome               String
  email              String?                     @unique
  telefone           String?
  escolaridade       String?
  isActive           Boolean                     @default(true)
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  profileData        Json?
  cpf                String?                     @unique
  curriculoUrl       String?
  laudoMedicoUrl     String?
  cep                String?
  cidade             String?
  dataNascimento     DateTime?
  endereco           String?
  estado             String?
  genero             String?
  linkedin           String?
  password           String?
  portfolio          String?
  avatarUrl          String?
  experiencias       String?
  acessibilidades    CandidatoAcessibilidade[]
  recursosAssistivos CandidatoRecursoAssistivo[]
  subtipos           CandidatoSubtipo[]
  candidaturas       Candidatura[]
  matchScores        MatchScore[]

  @@index([nome])
  @@index([email])
}

model RecursoAssistivo {
  id         Int                         @id @default(autoincrement())
  nome       String                      @unique
  descricao  String?
  createdAt  DateTime                    @default(now())
  updatedAt  DateTime                    @updatedAt
  candidatos CandidatoRecursoAssistivo[]
  mitigacoes RecursoBarreiraMitigacao[]
}

model CandidatoRecursoAssistivo {
  candidatoId       Int
  recursoId         Int
  usoFrequencia     String?
  impactoMobilidade String?
  candidato         Candidato        @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  recurso           RecursoAssistivo @relation(fields: [recursoId], references: [id], onDelete: Cascade)

  @@id([candidatoId, recursoId])
  @@index([recursoId])
}

model RecursoBarreiraMitigacao {
  recursoId  Int
  barreiraId Int
  eficiencia String?
  barreira   Barreira         @relation(fields: [barreiraId], references: [id], onDelete: Cascade)
  recurso    RecursoAssistivo @relation(fields: [recursoId], references: [id], onDelete: Cascade)

  @@id([recursoId, barreiraId])
  @@index([barreiraId])
}

model Candidatura {
  id          Int       @id @default(autoincrement())
  candidatoId Int
  vagaId      Int
  status      String    @default("Pendente")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  candidato   Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  vaga        Vaga      @relation(fields: [vagaId], references: [id], onDelete: Cascade)
  conversa    Conversa?

  @@unique([candidatoId, vagaId])
  @@index([vagaId])
  @@index([candidatoId])
}

model CandidatoSubtipo {
  candidatoId      Int
  subtipoId        Int
  acessibilidadeId Int?
  observacoes      String?
  prioridade       String?
  acessibilidade   Acessibilidade?            @relation(fields: [acessibilidadeId], references: [id])
  candidato        Candidato                  @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  subtipo          SubtipoDeficiencia         @relation(fields: [subtipoId], references: [id], onDelete: Cascade)
  barreiras        CandidatoSubtipoBarreira[]

  @@id([candidatoId, subtipoId])
  @@index([subtipoId])
  @@index([acessibilidadeId])
}

model CandidatoSubtipoBarreira {
  candidatoId      Int
  subtipoId        Int
  barreiraId       Int
  barreira         Barreira         @relation(fields: [barreiraId], references: [id], onDelete: Cascade)
  candidatoSubtipo CandidatoSubtipo @relation(fields: [candidatoId, subtipoId], references: [candidatoId, subtipoId], onDelete: Cascade)

  @@id([candidatoId, subtipoId, barreiraId])
  @@index([barreiraId])
}

model CandidatoAcessibilidade {
  candidatoId      Int
  acessibilidadeId Int
  prioridade       String         @default("importante")
  observacoes      String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  acessibilidade   Acessibilidade @relation(fields: [acessibilidadeId], references: [id], onDelete: Cascade)
  candidato        Candidato      @relation(fields: [candidatoId], references: [id], onDelete: Cascade)

  @@id([candidatoId, acessibilidadeId])
  @@index([acessibilidadeId])
}

model MatchScore {
  id                       Int       @id @default(autoincrement())
  candidatoId              Int
  vagaId                   Int
  scoreTotal               Int
  scoreAcessibilidades     Int
  scoreSubtipos            Int
  acessibilidadesAtendidas Int
  acessibilidadesTotal     Int
  detalhes                 Json?
  calculadoEm              DateTime  @default(now())
  updatedAt                DateTime  @updatedAt
  candidato                Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)
  vaga                     Vaga      @relation(fields: [vagaId], references: [id], onDelete: Cascade)

  @@unique([candidatoId, vagaId])
  @@index([scoreTotal])
  @@index([vagaId])
}

model Admin {
  id         Int      @id @default(autoincrement())
  nome       String
  email      String   @unique
  password   String
  cargo      String   @default("Administrador")
  permissoes Json?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([email])
}

// Sistema de Chat entre Empresa e Candidato
model Conversa {
  id            Int         @id @default(autoincrement())
  candidaturaId Int         @unique
  candidatura   Candidatura @relation(fields: [candidaturaId], references: [id], onDelete: Cascade)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  mensagens     Mensagem[]

  @@index([candidaturaId])
}

model Mensagem {
  id            Int      @id @default(autoincrement())
  conversaId    Int
  conversa      Conversa @relation(fields: [conversaId], references: [id], onDelete: Cascade)
  remetenteId   Int
  tipoRemetente String // "CANDIDATO" ou "EMPRESA"
  conteudo      String
  lida          Boolean  @default(false)
  createdAt     DateTime @default(now())

  @@index([conversaId])
  @@index([remetenteId])
}

// Sistema de Logs de Atividades para Admin
model ActivityLog {
  id          Int      @id @default(autoincrement())
  tipo        String // CANDIDATURA, VAGA, CADASTRO, CONTRATACAO, REJEICAO, LOGIN, PERFIL, CURRICULO, CHAT, MATCH
  acao        String // Descrição da ação
  usuarioNome String // Nome do usuário que realizou a ação
  usuarioTipo String // CANDIDATO, EMPRESA, ADMIN
  usuarioId   Int? // ID do usuário (opcional)
  entidadeId  Int? // ID da entidade relacionada (vaga, candidatura, etc)
  detalhes    Json? // Detalhes adicionais da ação
  createdAt   DateTime @default(now())

  @@index([tipo])
  @@index([usuarioTipo])
  @@index([createdAt])
}
